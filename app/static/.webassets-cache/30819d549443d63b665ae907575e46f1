Vvar exchange_data=0\u000avar currency_source='CNY'\u000avar currency_target='KRW'\u000avar curreycy_source_amount=0\u000avar curreycy_target_amount=0\u000avar fee=0\u000avar exchange_url_front="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.xchange%20where%20pair%20in%20(%22";var exchange_url_back="%22)&format=json&env=store://datatables.org/alltableswithkeys&callback=";$(document).ready(function(){function updateExchange(){currency_source_amount=$('#sourceAmount').val();var exchange_result=$('#sourceAmount').val()*parseFloat(exchange_data['query']['results']['rate']['Rate'])\u000acurrency_target_amount=exchange_result;$('#targetAmount').val(exchange_result.toFixed(3))\u000afee=$('#sourceAmount').val()*0.005\u000a$('#fee').text(fee)\u000aconsole.log(fee)\u000a$('#ask_rate').text(parseFloat(exchange_data['query']['results']['rate']['Bid']))\u000a$('#real_rate').text(parseFloat(exchange_data['query']['results']['rate']['Rate']))\u000a$('#saving').text(((1/parseFloat(exchange_data['query']['results']['rate']['Rate']))*parseInt($('#sourceAmount').val()*(parseFloat(exchange_data['query']['results']['rate']['Rate'])-parseFloat(exchange_data['query']['results']['rate']['Bid'])))-fee).toFixed(7));}\u000afunction updateRate(){if(currency_source=='KRW'&&currency_target=='CNY'){$.ajax({type:"GET",url:exchange_url_front+'CNY'+'KRW'+exchange_url_back,success:function(data){exchange_data=data;console.log(exchange_data['query']['results']['rate']);exchange_data['query']['results']['rate']['Bid']=((1.0000/exchange_data['query']['results']['rate']['Ask'])*0.93).toFixed(7);exchange_data['query']['results']['rate']['Rate']=(1.0000/exchange_data['query']['results']['rate']['Rate']).toFixed(7);updateExchange();},failure:function(errMsg){alert("a");}});}\u000aelse{$.ajax({type:"GET",url:exchange_url_front+currency_source+currency_target+exchange_url_back,success:function(data){exchange_data=data\u000aexchange_data['query']['results']['rate']['Bid']=(0.93*exchange_data['query']['results']['rate']['Bid']).toFixed(7);console.log(currency_source+','+currency_target);console.log(data);updateExchange();},failure:function(errMsg){alert("a");}});}}\u000a$('#sourceAmount').keyup(function(){updateExchange();})\u000aupdateRate();$(document).on("click",'.CNY .select_currency',function(){console.log('select KRW');$(this).parent().addClass('KRW');$(this).parent().children('.flag').children('img')[0].src='../../static/img/flag_south_korea.jpg'\u000a$(this).parent().children('.country_label')[0].innerHTML="KRW"\u000a$(this).parent().removeClass('CNY');if($(this).parent().parent().hasClass('exchange_from_row')){currency_source='KRW'\u000aconsole.log('source krw');}\u000aelse{currency_target='KRW';console.log('target krw');}\u000aupdateRate();})\u000a$(document).on("click",'.KRW .select_currency',function(){$(this).parent().addClass('CNY');$(this).parent().children('.flag').children('img')[0].src='../../static/img/flag_china.png'\u000a$(this).parent().children('.country_label')[0].innerHTML="CNY"\u000a$(this).parent().removeClass('KRW');if($(this).parent().parent().hasClass('exchange_from_row')){currency_source='CNY';console.log('source cny');}\u000aelse{currency_target='CNY'\u000aconsole.log('target cny');}\u000aupdateRate();})\u000avar source_is_active=false;$(document).on("click",'.CNY',function()\u000a{console.log($(this))\u000aif(source_is_active==false){var currency_select='<div class="select_currency"><div class="flag"><img src="../../static/img/flag_south_korea.jpg"></div><div class="country_label">KRW</div</div>'\u000a$(this).append(currency_select);source_is_active=true;}\u000aelse{console.log('remove')\u000aexchange_data=$(this)\u000a$(this).children(".select_currency").remove();source_is_active=false;}});var target_is_active=false;$(document).on("click",'.KRW',function()\u000a{if(source_is_active==false){console.log('add');var currency_select='<div class="select_currency"><div class="flag"><img src="../../static/img/flag_china.png"></div><div class="country_label">CNY</div</div>'\u000a$(this).append(currency_select);source_is_active=true;}\u000aelse{console.log('remove')\u000aexchange_data=$(this)\u000a$(this).children(".select_currency").remove();source_is_active=false;}});$(document).on("click",'.send_money',function()\u000a{var pathname=window.location.pathname;var send_info={"currency_source":currency_source,"currency_source_amount":currency_source_amount,"currency_target":currency_target,"currency_target_amount":currency_target_amount};$.ajax({type:"POST",url:'/authenticated/send_money',data:JSON.stringify({"send_info":send_info}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(data){window.location.href='/authenticated/account';},failure:function(errMsg){;}});});});
p1
.